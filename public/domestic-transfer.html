<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Domestic Transfer — PinnaTrustBank</title>

  <!-- Bootstrap & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
   <!-- Bootstrap -->
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  
   <!-- FontAwesome Icons -->
   <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
   
   <!-- Google Fonts -->
   <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
   
   <!-- Custom CSS -->
   <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
   <link rel="stylesheet" href="css/style.css" />
 

  <style>
    body{
        font-family: 'Inter', sans-serif;
    }
    .page-title { 
        font-weight:700;
        letter-spacing:.2px; 
    }
    .card-surface { background:#fff; border:1px solid #e7eaf0; border-radius:12px; }
    .section-note { font-size:.95rem; color:#5f6b7a; }
    .form-label .req { color:#4431d4; }
    .btn-pill { border-radius:10px; }
    .shadow-soft { box-shadow: 0 8px 18px rgba(18,38,63,.05); }
    @media (max-width: 576px){
      .btn-submit { width:100%; }
    }#sidebar .nav-link {
    position: relative;
    display: inline-block;
  }

  /* Tooltip styling */
  #sidebar .nav-link::after {
    content: attr(data-tooltip); /* take tooltip text from attribute */
    position: absolute;
    left: 60px; /* adjust distance from icon */
    top: 50%;
    transform: translateY(-50%);
    background: #fff;
    color: #000;
    padding: 4px 10px;
    border-radius: 6px;
    white-space: nowrap;
    font-size: 14px;
    font-weight: 500;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease, left 0.2s ease;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
  }

  /* Show tooltip on hover */
  #sidebar .nav-link:hover::after {
    opacity: 1;
    left: 50px; /* moves closer on hover for nice effect */
  }
  .nav-link:hover{
    color: white !important;
  }
  </style>
</head>
<body>

<div class="d-flex" id="wrapper">

  <!-- Sidebar -->
  <div class="bg-dark text-white py-4 sidebar" id="sidebar">
    <div class="text-center mb-4 mt-1 pe-2">
      <img src="./images/HI01FG5KkiWkx9iG6fa2VBQVQM.png" alt="" class="img-fluid">
    </div>
    <nav class="nav flex-column ps-3">
      <!-- Sidebar Links -->
      <a href="./index.html" class="nav-link text-white-50 fs-5 mb-2 mt-4" data-tooltip="Home">
        <i class="fas fa-home"></i>
      </a>
      <a href="./user-dashboard.html" class="nav-link text-white-50 fs-5 mb-2" data-tooltip="Dashboard">
        <i class="fas fa-circle-user"></i>
      </a>
      <a href="./statement.html" class="nav-link text-white-50 fs-5 mb-2" data-tooltip="Statement">
        <i class="fas fa-chart-line"></i>
      </a>
      <a href="./dom.html" class="nav-link text-white-50 fs-5 mb-2" data-tooltip="Transfer History">
        <i class="fas fa-clipboard-check"></i>
      </a>
      <a href="./domestic-transfer.html" class="nav-link text-white-50 fs-5 mb-2" data-tooltip="Domestic Transfer">
        <i class="fas fa-exchange-alt"></i>
      </a>
      <a href="./interbank-transfer.html" class="nav-link text-white-50 fs-5 mb-2" data-tooltip="Interbank Transfer">
        <i class="fas fa-money-bill-transfer"></i>
      </a>
      <a href="./wire-transfer.html" class="nav-link text-white-50 fs-5 mb-2" data-tooltip="Wire Transfer">
        <i class="fas fa-hand-holding-dollar"></i>
      </a>
      <a onclick="logout()" class="nav-link text-white-50 fs-5 mb-2" data-tooltip="Logout">
        <i class="fas fa-door-open"></i>
      </a>
      <a href="./profile.html" class="nav-link text-white-50 fs-5 mt-5" data-tooltip="Profile">
        <img src="" alt="" class="rounded-circle" width="30" height="30" alt="Profile" id="profilePic">
      </a>
    </nav>
  </div>

  <!-- Page Content -->
  <div id="page-content-wrapper" class="col-11 ml-6">

     <!-- Navbar -->
     <nav class="navbar bg-white shadow-sm p-3">
      <div class="container d-flex justify-content-between align-items-center">
        
        <!-- Left: Logo -->
        <a class="navbar-brand fw-bold fs-4" href="./index.html"><img src="./images/HI01FG5KkiWkx9iG6fa2VBQVQM.png" alt="logo"/> PinnaTrustBank<span style="color: #4635C4">.</span></a>

        <!-- Center: Navigation Links -->
        <div class="d-flex justify-content-end align-items-center d-none d-lg-block">
          <span class="me-3 fw-bold" id="name1">User</span>
          <img src="" class="rounded-circle" width="40" height="40" alt="Profile" id="profilePic2">
        </div>

        <!-- Toggle for Mobile -->
        <button class="navbar-toggler d-lg-none" type="button" data-bs-toggle="collapse" data-bs-target="#mobileMenu">
          <span class="navbar-toggler-icon"></span>
        </button>
      </div>

      <!-- Mobile Menu -->
      <div class="collapse navbar-collapse d-lg-none bg-dark px-4" id="mobileMenu">
        <ul class="navbar-nav">
          <a href="./index.html" class="nav-link text-white-50 fs-5 mb-2 mt-4">
            <i class="fas fa-home me-2"></i> <span>Go To Home</span>
          </a>
          <a href="./user-dashboard.html" class="nav-link text-white-50 fs-5 mb-2">
            <i class="fas fa-circle-user me-2"></i> <span>Dashboard Overview</span>
          </a>
          <a href="./statement.html" class="nav-link text-white-50 fs-5 mb-2">
            <i class="fas fa-chart-line me-2"></i> <span>Bank Statement</span>
          </a>
          <a href="./dom.html" class="nav-link text-white-50 fs-5 mb-2">
            <i class="fas fa-clipboard-check me-2"></i> <span>Transfer History</span>
          </a>
          <a href="./domestic-transfer.html" class="nav-link text-white fs-5 mb-2">
            <i class="fas fa-exchange-alt me-2"></i> <span>Domestic Transfer</span>
          </a>
          <a href="./interbank-transfer.html" class="nav-link text-white-50 fs-5 mb-2">
            <i class="fas fa-money-bill-transfer me-2"></i> <span>Interbank Transfer</span>
          </a>
          <a href="./wire-transfer.html" class="nav-link text-white-50 fs-5 mb-2">
            <i class="fas fa-hand-holding-dollar me-2"></i> <span>Wire Transfer</span>
          </a>
          <a onclick="logout()" class="nav-link text-white-50 fs-5 mb-2">
            <i class="fas fa-door-open me-2"></i> <span>Logout</span>
          </a>
        </ul>
      </div>
    </nav>
    


    <div class="container py-4">
        <h2 class="page-title mb-3">Domestic Transfer</h2>

        <!-- Banner -->
        <div class="alert alert-warning d-flex align-items-center shadow-soft" role="alert">
            <i class="bi bi-exclamation-triangle me-2"></i>
            <div><strong>Notice:</strong> Ensure you fill the forms Carefully and correctly</div>
        </div>

        <!-- Transfer Card -->
        <div class="card-surface shadow-soft">
        <div class="card-body p-4 p-lg-5">
            <h5 class="mb-4 detail fw-semibold">Enter Transfer Details</h5>

            <!-- ========== DOMESTIC TRANSFER FORM ========== -->
<form id="domesticTransferForm" novalidate>
  <div class="row g-3">

    <!-- Beneficiary Name -->
    <div class="col-md-6">
      <label for="beneficiaryName" class="form-label">Beneficiary Account Name <span class="req">*</span></label>
      <input type="text" id="beneficiaryName" name="beneficiaryName" class="form-control border" placeholder="e.g., John A. Doe" required>
    </div>

    <!-- Beneficiary Account Number -->
    <div class="col-md-6">
      <label for="beneficiaryAccount" class="form-label">Beneficiary Account Number <span class="req">*</span></label>
      <input type="text" id="beneficiaryAccount" name="beneficiaryAccount" class="form-control border" placeholder="e.g., 6037011580" required>
    </div>

    <!-- Bank Name -->
    <div class="col-md-6">
      <label for="bankName" class="form-label">Bank Name <span class="req">*</span></label>
      <input type="text" id="bankName" name="bankName" class="form-control border" placeholder="e.g., Airstro Bank" required>
    </div>

    <!-- Amount -->
    <div class="col-md-6">
      <label for="amount" class="form-label">Amount <span class="req">*</span></label>
      <div class="input-group">
        <span class="input-group-text">USD $</span>
        <input type="number" id="amount" name="amount" class="form-control border" step="0.01" min="1" placeholder="0.00" required>
      </div>
    </div>

    <!-- Account Type -->
    <div class="col-md-6">
      <label for="accountType" class="form-label">Account Type <span class="req">*</span></label>
      <select id="accountType" name="accountType" class="form-select" required>
        <option value="Savings" selected>Savings</option>
        <option value="Checking">Checking</option>
        <option value="Current">Current</option>
        <option value="Business">Business</option>
        <option value="Student">Student</option>
      </select>
    </div>

    <!-- Description -->
    <div class="col-12">
      <label for="description" class="form-label">Description <span class="req">*</span></label>
      <textarea id="description" name="description" class="form-control border" rows="3" placeholder="Transfer Description" required></textarea>
    </div>
  </div>

  <!-- Submit -->
  <div class="d-flex justify-content-end mt-4 mb-3">
    <button type="submit" class="btn py-2 px-4 detail-bg text-white">
      <i class="bi bi-arrow-right-circle me-2"></i> Transfer
    </button>
  </div>
</form>


<!-- ========== PASSWORD CONFIRM MODAL ========== -->
<div class="modal fade" id="confirmPasswordModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirm Transaction</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <form action="">
          <label for="transactionPassword" class="form-label">Enter Password</label>
          <input type="password" id="transactionPassword" class="form-control" placeholder="--- ---" required>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>
        <button type="button" id="confirmTransactionBtn" class="btn btn-success">Confirm</button>
      </div>
    </div>
  </div>
</div>


<!-- ========== SUCCESS MODAL ========== -->
<div class="modal fade" id="successModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-4">
      <button type="button" class="btn-close float-right" data-bs-dismiss="modal"></button>
      <div class="checkmark-wrapper">
        <svg viewBox="0 0 52 52">
          <circle class="circle" cx="26" cy="26" r="24" />
          <path class="checkmark" d="M14 27 L22 35 L38 18" />
        </svg>
      </div>
      <h4 class="modal-title text-center">Transaction Successful</h4>
      <h5 class="text-success text-center mt-2" id="s_amount"></h5>
      <div class="modal-body">
        <p class="d-flex justify-content-between"><span>Beneficiary Name:</span> <span class="fw-semibold" id="s_beneficiaryName"></span></p>
        <p class="d-flex justify-content-between"><span>Account Number:</span> <span class="fw-semibold" id="s_beneficiaryAccount"></span></p>
        <p class="d-flex justify-content-between"><span>Bank:</span> <span class="fw-semibold" id="s_bankName"></span></p>
        <p class="d-flex justify-content-between"><span>Account Type:</span> <span class="fw-semibold" id="s_accountType"></span></p>
        <p class="d-flex justify-content-between"><span>Description:</span> <span class="fw-semibold" id="s_description"></span></p>
        <!-- <hr> -->
        <p class="d-flex justify-content-between"><span>Date & Time:</span> <span class="fw-semibold" id="s_date"></span></p>
        <p class="d-flex justify-content-between"><span>Reference No.:</span> <span class="fw-semibold" id="s_reference"></span></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-success" data-bs-dismiss="modal">Done</button>
      </div>
    </div>
  </div>
</div>



            <i class="section-note mt-4 mb-0">
            Transfers may be subject to review. Ensure recipient details are correct before submitting.
            </i>
        </div>
        </div>
    </div>

    
    </div>
    </div>
    <footer class="bg-dark text-white  pt-5 pb-2"style="background-image: url(./images/world-dotted-map.png); background-position: center; background-size: 60%; background-repeat: no-repeat;">
        <div class="container">
          <div class="row gy-4 justify-content-between py-5">
      
            <!-- Quick Navigation -->
            <div class="col-lg-2 col-md-6">
              <h6 class="text-uppercase fw-semibold">Company</h6>
              <ul class="list-unstyled mt-3">
                <li><a href="./index.html" class="text-white-50 text-decoration-none d-block mb-2">Home</a></li>
                <li><a href="./about.html" class="text-white-50 text-decoration-none d-block mb-2">About Us</a></li>
                <li><a href="./features.html" class="text-white-50 text-decoration-none d-block mb-2">Features</a></li>
                <li><a href="./reviews.html" class="text-white-50 text-decoration-none d-block mb-2">Our Reviews</a></li>
                <li><a href="./contact.html" class="text-white-50 text-decoration-none d-block">Contact Us</a></li>
              </ul>
            </div>

            <!-- Resources -->
            <div class="col-lg-3 col-md-6">
              <h6 class="text-uppercase fw-semibold">User Dashboard</h6>
              <ul class="list-unstyled mt-3">
                <li><a href="./user-dashboard.html" class="text-white-50 text-decoration-none d-block mb-2">Overview</a></li>
                <li><a href="./statement.html" class="text-white-50 text-decoration-none d-block mb-2">Bank Statement</a></li>
                <li><a href="./interbank-transfer.html" class="text-white-50 text-decoration-none d-block mb-2">Inter-BankTransfer</a></li>
                <li><a href="./domestic-transfer.html" class="text-white-50 text-decoration-none d-block mb-2">Domestic Transfer</a></li>
                <li><a href="./wire-transfer.html" class="text-white-50 text-decoration-none d-block">Wire Transfer</a></li>
              </ul>
            </div>

            <!-- Contact Info -->
            <div class="col-lg-3">
              <h6 class="text-uppercase fw-semibold">Contact</h6>
              <ul class="list-unstyled mt-3 text-white-50">
                <li><i class="bi bi-envelope-fill me-2"></i>support@pinnatrustbank.com</li>
          <li class="mt-2"><i class="bi bi-telephone-fill me-2"></i>+1 (202)-984-9810</li>
          <li class="mt-2"><i class="bi bi-geo-alt-fill me-2"></i>441 Q St NW Washington, DC 20001</li>
              </ul>
            </div>
          </div>
      
          <!-- Bottom Bar -->
          <div class="text-center border-top border-secondary mt-2 py-4">
            <small class="text-white-50">&copy; 2025 PinnaTrustBank. All rights reserved.</small>
          </div>
        </div>
      </footer>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  
 
    <!-- FOR EXPORTING TRANSFER DETAILS  -->
    <script>
      function saveTransaction(form) {
      const transactionId = "TX" + Math.floor(Math.random() * 1000000);
      const transaction = {
        id: transactionId,
        amount: form.amount.value ? `$${form.amount.value}` : "$0.00",
        name: form.beneficiaryName.value || "N/A",
        account: form.beneficiaryAccount.value || "N/A",
        type: form.accountType.value || "N/A",
        description: form.description.value || "N/A",
        bank: form.bankName.value || "N/A",
        date: new Date().toLocaleString(),
        status: "Success",
      };

      // Get old transactions from localStorage
      let transactions = JSON.parse(localStorage.getItem("transactions")) || [];

      // Add new one
      transactions.push(transaction);

      // Save back to localStorage
      localStorage.setItem("transactions", JSON.stringify(transactions));
      
    }

    </script>

<script>
  function getBalance() {
    let balance = localStorage.getItem("accountBalance");
    if (!balance) {
      balance = 669013.00; // default starting balance
      localStorage.setItem("accountBalance", balance);
    }
    return parseFloat(balance);
  }

  function updateBalanceDisplay() {
    const balanceElements = document.querySelectorAll(".balance-amount");
    const balance = getBalance();
    balanceElements.forEach(el => {
      el.textContent = "USD $" + balance.toLocaleString(undefined, {minimumFractionDigits: 2});
    });
  }

  function deductBalance(amount) {
    let balance = getBalance();
    balance -= parseFloat(amount);
    if (balance < 0) balance = 0;
    localStorage.setItem("accountBalance", balance);
    updateBalanceDisplay();
  }

  // Update balance on load
  document.addEventListener("DOMContentLoaded", updateBalanceDisplay);
</script>


  <script>
    document.getElementById("domesticTransferForm").addEventListener("submit", function(e) {
      e.preventDefault(); // stop refresh
      new bootstrap.Modal(document.getElementById("confirmPasswordModal")).show();
    });
    
    document.getElementById("confirmTransactionBtn").addEventListener("click", async () => {
      const password = document.getElementById("transactionPassword").value;
      const token = localStorage.getItem("token");
    
      try {
        const res = await fetch("/api/user/verify-password", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
          },
          body: JSON.stringify({ password })
        });
    
        const data = await res.json();
        console.log("verify-password response:", data);
    
        if (!res.ok) {
          alert(data.error || "Invalid password");
          return;
        }
    
        // ✅ hide password modal
        const confirmModal = bootstrap.Modal.getInstance(document.getElementById("confirmPasswordModal"));
        if (confirmModal) confirmModal.hide();
    
        // ✅ get wire transfer form values
        const form = document.getElementById("domesticTransferForm");
    
        document.getElementById("s_beneficiaryName").textContent = form.beneficiaryName.value;
        document.getElementById("s_beneficiaryAccount").textContent = form.beneficiaryAccount.value;
        document.getElementById("s_bankName").textContent = form.bankName.value || "N/A";
        document.getElementById("s_amount").textContent = "$" + form.amount.value;
        document.getElementById("s_accountType").textContent = form.accountType.value;
        document.getElementById("s_description").textContent = form.description.value || "N/A";
    
        // ✅ new fields (extra beneficiary info)
        document.getElementById("s_date").textContent = new Date().toLocaleString();
        document.getElementById("s_reference").textContent = "REF" + Math.floor(Math.random() * 1000000000);
    
        // ✅ show success modal
        new bootstrap.Modal(document.getElementById("successModal")).show();
        
        // ✅ save transaction in localStorage
        saveTransaction(form);

        // ✅ deduct from balance
        deductBalance(form.amount.value || 0);
    
      } catch (err) {
        console.error("Frontend error in verify-password:", err);
        alert("Server error, try again later.");
      }
    });
    </script>
   

  <script>
    function logout() {
      localStorage.removeItem('token');
      window.location.href = '/user-login.html';
    }
    
    // ✅ Redirect if not logged in
    if (!localStorage.getItem('token')) {
      window.location.href = '/user-login.html';
    }
    
    document.addEventListener("DOMContentLoaded", () => {
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = '/user-login.html';
      return;
    }
  
    fetch('/api/user/profile', {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
    .then(res => {
      if (res.status === 401) {
        localStorage.removeItem('token');
        window.location.href = '/login.html';
        return;
      }
      return res.json();
    })
    .then(user => {
      
      // Profile picture
      if (user.profilePicture) {
        const profilePic = document.getElementById("profilePic");
        const profilePic2 = document.getElementById("profilePic2");
        if (profilePic) profilePic.src = user.profilePicture;
        if (profilePic2) profilePic2.src = user.profilePicture;
      }

      if (user) {
        document.getElementById('name1').textContent = `${user.fullName}`;
        document.getElementById('name2').textContent = `${user.fullName}`;
        document.getElementById('name3').textContent = `${user.fullName}`;
        document.querySelector('.banner p').textContent = `Tips: Change your Internet banking password frequently to keep your account safe`;
      }
    })
    .catch(err => console.error(err));
  });
    </script>
</body>
</html>
